## Клиенты

#### Представление Клиенты

| **Поле**                                    | **Название поля в системе**    | **Формат / возможные значения**  | **Описание**                                                                  |
|:-------------------------------------------:|:------------------------------:|:--------------------------------:|:-----------------------------------------------------------------------------:|
| Идентификатор клиента                       | Customer_ID                    | ---                              | Уникальное значение                                                           |
| Значение среднего чека                      | Customer_Average_Check         | Арабская цифра, десятичная дробь | Значение среднего чека клиента в рублях за анализируемый период               |
| Сегмент по среднему чеку                    | Customer_Average_Check_Segment | Высокий; Средний; Низкий         | Описание сегмента                                                             |
| Значение частоты транзакций                 | Customer_Frequency             | Арабская цифра, десятичная дробь | Значение частоты визитов клиента в среднем количестве дней между транзакциями |
| Сегмент по частоте транзакций               | Customer_Frequency_Segment     | Часто; Средне; Редко             | Описание сегмента                                                             |
| Количество дней после предыдущей транзакции | Customer_Inactive_Period       | Арабская цифра, десятичная дробь | Количество дней, прошедших с даты предыдущей транзакции клиента               |
| Коэффициент оттока                          | Customer_Churn_Rate            | Арабская цифра, десятичная дробь | Значение коэффициента оттока клиента                                          |
| Сегмент по коэффициенту оттока              | Customer_Churn_Segment         | Высокий; Средний; Низкий         | Описание сегмента                                                             |
| Номер сегмента                              | Customer_Segment               | Арабская цифра                   | Номер сегмента, к которому принадлежит клиент                                 |
| Идентификатор основного магазина            | Customer_Primary_Store         | ---                              | ---                                                                           |

Сегментация по величине среднего чека

1.  **Формирование списков карт.** Для каждого клиента формируется
    перечень всех его карт на основании данных в полях `Customer_ID` и
    `Customer_Card_ID` таблицы [Карты](../README.md#таблица-карты).

2.  **Расчет среднего чека.** Для каждого клиента определяется величина
    среднего чека за анализируемый период. Источник данных – таблица
    [Транзакции](../README.md#таблица-транзакции). Суммируются все транзакции по всем картам каждого
    клиента по полю `Transaction_Summ` таблицы [Транзакции](../README.md#таблица-транзакции), после
    чего полученная сумма делится на количество транзакций. Полученные
    данные сохраняются в поле `Customer_Average_Check` таблицы Клиенты.

3.  **Ранжирование клиентов.** Все клиенты в выборке ранжируются по
    величине среднего чека (полю `Customer_Average_Check` таблицы Клиенты) от наибольших к наименьшим значениям.

4.  **Определение сегмента.** 10% клиентов с наивысшим показателем
    среднего чека относятся к сегменту `High`. Следующие 25% клиентов с
    наивысшим показателем среднего чека относятся к сегменту `Medium`.
    Оставшиеся клиенты с наименьшим показателем среднего чека относятся
    к сегменту `Low`. Данные указываются в поле
    `Customer_Average_Check_Segment` таблицы Клиенты.

Сегментация по частоте визитов

5.  **Определение интенсивности транзакций.** Для каждого клиента
    определяется его текущая частота визитов в среднем интервале между
    визитами в днях. Для этого из даты самой поздней на момент
    формирования анализа транзакции вычитается дата самой ранней за
    анализируемый период транзакции. Данные берутся из поля
    `Transaction_DateTime` таблицы [Транзакции](../README.md#таблица-транзакции). Полученное значение
    делится на общее количество транзакций клиента за анализируемый
    период. Количество транзакций клиента определяется как количество
    уникальных значений в поле `Transaction_ID` для всех карт клиента.
    Полученные данные сохраняются в поле `Customer_Frequency` таблицы
    Клиенты.

6.  **Ранжирование клиентов.** Все клиенты в выборке ранжируются по
    частоте визитов (полю `Customer_Frequency` таблицы Клиенты)
    от наименьших к наибольшим значениям.

7.  **Определение сегмента.** 10% клиентов с наименьшими значениями
    интервалов между визитами обладают наивысшей частотой визитов и
    относятся к сегменту `Often`. Следующие 25% клиентов с наименьшими
    интервалами между визитами относятся к сегменту `Occasionally`. Оставшиеся
    65% клиентов относятся к сегменту `Rarely`. Данные указываются в поле
    `Customer_Frequency_Segment` таблицы Клиенты.

Сегментация по вероятности оттока

8.  **Определение периода после предыдущей транзакции.** Для каждого
    клиента необходимо определить количество дней, прошедших после самой
    поздней на момент анализа транзакции. Для этого из [даты формирования анализа](../README.md#таблица-дата-формирования-анализа) вычитается дата самой поздней транзакции
    клиента. Данные берутся из поля `Transaction_DateTime` таблицы [Транзакции](../README.md#таблица-транзакции) по всем картам клиента.

9.  **Расчет коэффициента оттока.** Для каждого клиента количество дней,
    прошедших с даты предыдущей транзакции (значение поля
    `Customer_Inactive_Period` таблицы Клиенты), делится на
    интенсивность транзакций клиента в прошлом (значение поля
    `Customer_Frequency` таблицы Клиенты). Получившийся результат сохраняется в поле `Customer_Churn_Rate`
    таблицы Клиенты.

10. **Определение вероятности оттока.** В случае, если полученный
    коэффициент находится в интервале от 0 до 2, вероятность оттока
    клиента оценивается как `Low`. Если коэффициент находится в
    интервале от 2 до 5, вероятность оттока оценивается как `Medium`. В
    случае, если значение превышает 5, присваивается значение `High`.
    Получившийся результат сохраняется в поле `Customer_Churn_Segment`
    таблицы Клиенты.

Присвоение клиенту номера сегмента

11. **Присвоение номера сегмента.** На основании комбинации значений
    клиента в полях `Customer_Average_Check_Segment`,
    `Customer_Frequency_Segment` и `Customer_Churn_Segment` таблицы Клиенты клиенту присваивается номер сегмента в соответствии со
    следующей таблицей:

| **Сегмент** | **Средний чек** | **Частота покупок** | **Вероятность оттока** |
|-------------|-----------------|---------------------|------------------------|
| 1           | Низкий          | Редко               | Низкая                 |
| 2           | Низкий          | Редко               | Средняя                |
| 3           | Низкий          | Редко               | Высокая                |
| 4           | Низкий          | Средне              | Низкая                 |
| 5           | Низкий          | Средне              | Средняя                |
| 6           | Низкий          | Средне              | Высокая                |
| 7           | Низкий          | Часто               | Низкая                 |
| 8           | Низкий          | Часто               | Средняя                |
| 9           | Низкий          | Часто               | Высокая                |
| 10          | Средний         | Редко               | Низкая                 |
| 11          | Средний         | Редко               | Средняя                |
| 12          | Средний         | Редко               | Высокая                |
| 13          | Средний         | Средне              | Низкая                 |
| 14          | Средний         | Средне              | Средняя                |
| 15          | Средний         | Средне              | Высокая                |
| 16          | Средний         | Часто               | Низкая                 |
| 17          | Средний         | Часто               | Средняя                |
| 18          | Средний         | Часто               | Высокая                |
| 19          | Средний         | Редко               | Низкая                 |
| 20          | Высокий         | Редко               | Средняя                |
| 21          | Высокий         | Редко               | Высокая                |
| 22          | Высокий         | Средне              | Низкая                 |
| 23          | Высокий         | Средне              | Средняя                |
| 24          | Высокий         | Средне              | Высокая                |
| 25          | Высокий         | Часто               | Низкая                 |
| 26          | Высокий         | Часто               | Средняя                |
| 27          | Высокий         | Часто               | Высокая                |

Определение основного магазина клиента

12. **Определение перечня магазинов клиента.** Для каждого клиента для
    всех его карт формируется перечень магазинов, в которых он совершал
    транзакции в течение анализируемого периода. Одному клиенту могут
    соответствовать несколько магазинов. Для этого используется данные,
    содержащиеся в поле `Transaction_Store_ID` таблицы [Транзакции](../README.md#таблица-транзакции).
    После формирования список дедублицируется.

13. **Расчет доли транзакций в каждом магазине.** Для каждого магазина,
    в котором клиент совершал покупки, указывается доля транзакций,
    совершенных в этом магазине. Для этого количество уникальных
    транзакций в каждом конкретном магазине делится на общее количество
    уникальных транзакций клиента. Для расчетов используются данные,
    содержащиеся в поле `Transaction_ID` и `Transaction_Store_ID`
    таблицы [Транзакции](../README.md#таблица-транзакции).

14. **Определение магазина, в котором клиент совершил три предыдущие
    транзакции.** Для каждого клиента для всех его карт определяется
    магазин или магазины, в котором(-ых) были совершены три самые
    поздние транзакции. Для этого используются данные, содержащиеся в
    полях `Transaction_Store_ID` и `Transaction_DateTime`.

15. **Определение основного магазина клиента.** Для каждого клиента
    определяется его основной магазин. В случае, если три последние
    транзакции совершены в одном и том же магазине, в качестве основного
    магазина клиента устанавливает этот магазин. В ином случае в
    качестве основного магазина клиента указывается магазин, в котором
    совершена наибольшая доля всех транзакций клиента. В случае, если
    для нескольких магазинов указана одинаковая доля транзакций, в
    качестве основного магазина выбирается тот из них, в которым была
    совершена самая поздняя транзакция. Получившееся значение
    указывается в поле `Customer_Primary_Store` таблицы Клиенты.
